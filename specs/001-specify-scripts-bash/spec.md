# Feature Specification: Chromeリモートデバッグ起動ユーティリティ

**Feature Branch**: `001-specify-scripts-bash`  
**Created**: 2025-10-18  
**Status**: Draft  
**Input**: User description: "実行可能ファイルを作成したい。この実行可能ファイルは、Webアプリケーション開発のシーンで使うことを想定しており、以下の機能をもつ: - 指定したURLのページをPlaywright等で操作できるようにremote-debugging-portを指定したChromeで開く - 一度Chromeを閉じた後再度開いた際に状態を復元できるよう、引数で「プロファイル名」を指定できるようにして、プロファイルごとに個別にユーザーデータを保存する"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 自動テスト用ブラウザを即時に立ち上げたい (Priority: P1)

Webアプリ開発者として、対象URLを指定してコマンドを叩くと、外部自動化ツールから操作可能なブラウザが即座に起動してほしい。

**Why this priority**: 自動テストやデバッグをすぐ開始できることが本機能の主目的であり、価値の大半を占めるため。

**Independent Test**: URLとプロファイル名を指定した単体コマンド実行でブラウザ起動とリモートデバッグ接続が確認できれば完結。

**Acceptance Scenarios**:

1. **Given** 開発者が有効なURLとプロファイル名を指定してコマンドを準備している, **When** 実行可能ファイルを起動する, **Then** 数秒以内に対象URLが開いたブラウザウィンドウが表示され、リモートデバッグ用エンドポイント情報が出力される
2. **Given** 外部自動化ツールがリモートデバッグ用エンドポイントに接続を試みる, **When** ブラウザが起動済み, **Then** 接続が成功し、操作コマンドがブラウザに反映される

---

### User Story 2 - 以前の状態を保ったままブラウザを再起動したい (Priority: P2)

Webアプリ開発者として、同じプロファイル名で再度コマンドを実行した際に、前回のログイン状態やクッキーを引き継いで作業を再開できるようにしたい。

**Why this priority**: 状態復元によりテストの再現性が上がり、手動での再ログイン等の無駄時間を減らせるため。

**Independent Test**: 初回実行で状態を保存し、Chromeを閉じた後に同じプロファイルで再実行して状態が維持されていれば目的達成。

**Acceptance Scenarios**:

1. **Given** 開発者が同一プロファイル名で2回目のコマンド実行を行う, **When** ブラウザが再起動する, **Then** 前回保持したセッション情報（例: ログイン状態・ローカルストレージ）が利用可能である
2. **Given** プロファイル専用ディレクトリにアクセスできない状況, **When** コマンドを実行する, **Then** 明確なエラーメッセージで状態復元が失敗したことと対処方法が通知される

---

### User Story 3 - 複数セッションを安全に並行運用したい (Priority: P3)

QAエンジニアとして、別のプロファイルやポート番号を指定すれば、他の開発者や自動テストと競合せずにブラウザを起動できるようにしたい。

**Why this priority**: チームでの同時作業やCI環境での並列実行を妨げないため。

**Independent Test**: 異なるプロファイル名やポート番号で複数回コマンドを実行し、互いに干渉せず起動できることを確認すれば成立。

**Acceptance Scenarios**:

1. **Given** 異なるプロファイル名とポート番号を用意している, **When** 複数回コマンドを実行する, **Then** 各ブラウザが独立して起動し、競合エラーが発生しない
2. **Given** 指定したポートがすでに使用中である, **When** コマンドを実行する, **Then** 競合を検知して別ポートの提案や再実行手順を含むエラーメッセージを表示する

---

### Edge Cases

- 無効なURL形式や未指定の必須引数でコマンドを実行した場合は、ブラウザを起動せず入力不備を通知する
- 指定したプロファイル名でブラウザが既に起動中の場合は、重複起動によるデータ破損を防ぐため警告して終了する
- プロファイル用ディレクトリが作成できない/書き込み不可の場合は、理由と対処手順を明示して失敗を通知する
- Chrome実行ファイルが見つからない場合は、想定パスと設定方法を案内する
- ポート番号が指定されず自動割り当てを行う際、連続した試行にも対応して利用可能な番号を選定する

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 実行可能ファイルはURLとプロファイル名を必須引数として受け取り、形式妥当性を検証した上で処理を開始しなければならない
- **FR-002**: 実行成功時、指定URLを開いたChromeウィンドウを起動し、リモートデバッグ接続先のポート番号とアクセスポイントを標準出力へ表示しなければならない
- **FR-003**: プロファイル名ごとに専用のユーザーデータディレクトリを作成・再利用し、再実行時に前回のブラウザ状態（クッキー、ローカルストレージ等）を復元できなければならない
- **FR-004**: 指定ポートが未使用の場合はそのまま利用し、未指定の場合は衝突しないポートを自動割り当てて通知しなければならない
- **FR-005**: 同一プロファイル名で既存のブラウザセッションが動作中の場合は重複起動を拒否し、利用者にセッション終了や別プロファイル選択を促すメッセージを表示しなければならない
- **FR-006**: Chrome起動やプロファイル読み込みに失敗した際は原因（ポート競合、権限不足、実行ファイル未検出等）を分類したエラーハンドリングを行い、ログと終了コードで明示しなければならない

### Key Entities

- **ブラウザプロファイル**: プロファイル名に紐づいたユーザーデータ保管単位。保存内容はクッキー、ローカル/セッションストレージ、キャッシュなどブラウザが管理する状態を含む
- **リモートデバッグセッション**: 外部自動化ツールが接続するためのブラウザインスタンス。接続先ポート、起動されたURL、紐づくプロファイル名と状態を持つ

## Assumptions

- 開発者の環境にはChrome（または互換ブラウザ）がインストール済みで、起動パスを事前に設定可能である
- リモートデバッグに接続する外部ツールはChrome DevToolsプロトコル互換であることを前提とし、個別ツール固有の設定は対象外とする
- プロファイルデータの保存先はローカルマシン上で十分なストレージが確保されているものとする

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: コマンド実行からブラウザウィンドウが操作可能になるまでの時間が90%のケースで5秒以内に収まる
- **SC-002**: 外部自動化ツールがリモートデバッグエンドポイントに接続して操作コマンドを送信できる成功率が100回の試行中95%以上である
- **SC-003**: 同一プロファイルを再利用した際、直前セッションで保存されたログイン状態が少なくとも20件のテストケース中19件以上で再現される
- **SC-004**: ユーザビリティ評価で、開発者が「手動設定と比べて作業時間が短縮された」と回答する割合がアンケート回答者の80%以上となる
